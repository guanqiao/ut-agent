# UT-Agent 详细开发计划

## 项目概述

**项目名称**: UT-Agent - AI驱动的单元测试生成Agent  
**当前版本**: 0.1.0  
**目标版本**: 1.0.0  
**计划周期**: 4-5个月  

---

## 一、Phase 1: 核心增强 (第1-2月)

### 1.1 VS Code 插件开发

**任务描述**: 开发 VS Code 扩展，实现 IDE 内一键生成测试  
**优先级**: P0  
**时间预估**: 2周  
**计划完成时间**: 第1月第2周  

**详细任务**:
1. 创建 VS Code 扩展项目结构
2. 实现右键菜单："Generate Unit Test"
3. 实现侧边栏面板：配置 LLM 提供商、覆盖率目标
4. 实现状态栏显示：当前覆盖率、生成状态
5. 集成 UT-Agent CLI 命令
6. 实现测试结果预览和 diff 对比

**依赖关系**: 无  
**完成标准**:
- [ ] 插件可在 VS Code 市场安装
- [ ] 右键菜单正常显示和工作
- [ ] 生成的测试可在编辑器中预览
- [ ] 支持配置同步

**测试用例**:
1. 在 Java 文件右键生成测试，验证文件创建
2. 在 Vue 文件右键生成测试，验证组件测试生成
3. 修改配置后重新生成，验证配置生效

---

### 1.2 跨文件上下文分析

**任务描述**: 增强代码分析器，理解跨文件依赖关系  
**优先级**: P0  
**时间预估**: 2周  
**计划完成时间**: 第1月第4周  

**详细任务**:
1. 实现项目级 AST 索引
2. 实现依赖关系图构建
3. 实现接口/抽象类实现查找
4. 实现调用链分析
5. 增强 Mock 生成逻辑（基于真实依赖）

**依赖关系**: 1.1  
**完成标准**:
- [ ] 能识别被测类的所有依赖
- [ ] 能生成准确的 Mockito @Mock 注入
- [ ] 能识别接口的实现类并建议 Mock

**测试用例**:
1. 分析有 3 个依赖的 Service 类，验证 Mock 生成完整
2. 分析继承关系的类，验证父类方法测试覆盖

---

### 1.3 测试模板库

**任务描述**: 建立可复用的测试模板系统  
**优先级**: P1  
**时间预估**: 1.5周  
**计划完成时间**: 第2月第2周  

**详细任务**:
1. 设计模板数据结构（YAML/JSON 格式）
2. 实现模板引擎（Jinja2）
3. 创建常用模板：
   - Spring Boot Controller 测试模板
   - Service 层测试模板
   - Repository 测试模板
   - Vue 组件测试模板
   - React Hook 测试模板
4. 实现模板热加载
5. 支持用户自定义模板

**依赖关系**: 1.2  
**完成标准**:
- [ ] 至少 5 个内置模板
- [ ] 模板可参数化配置
- [ ] 用户可添加自定义模板

**测试用例**:
1. 使用 Controller 模板生成测试，验证结构符合 Spring Boot 规范
2. 自定义模板并加载，验证生效

---

### 1.4 JetBrains 插件开发

**任务描述**: 开发 IntelliJ IDEA / PyCharm 插件  
**优先级**: P1  
**时间预估**: 2周  
**计划完成时间**: 第2月第4周  

**详细任务**:
1. 创建 IntelliJ 插件项目（Kotlin）
2. 实现 Action："Generate Unit Test"
3. 实现 Tool Window：配置面板
4. 集成 UT-Agent CLI
5. 支持多模块项目

**依赖关系**: 1.1, 1.2, 1.3  
**完成标准**:
- [ ] 插件可在 JetBrains 插件市场安装
- [ ] 支持 Java/Kotlin 项目
- [ ] 支持 Gradle/Maven 项目识别

---

## 二、Phase 2: 体验优化 (第2-3月)

### 2.1 可视化 HTML 报告

**任务描述**: 生成美观的 HTML 覆盖率报告  
**优先级**: P0  
**时间预估**: 1.5周  
**计划完成时间**: 第3月第2周  

**详细任务**:
1. 设计报告模板（响应式布局）
2. 实现覆盖率趋势图（Chart.js）
3. 实现代码高亮和覆盖标记
4. 实现缺口代码高亮显示
5. 实现历史报告对比
6. 支持导出 PDF

**依赖关系**: 无  
**完成标准**:
- [ ] 报告可在浏览器打开
- [ ] 包含趋势图表
- [ ] 未覆盖代码高亮显示

**测试用例**:
1. 生成报告并验证所有指标显示正确
2. 对比两次报告，验证趋势计算正确

---

### 2.2 增量测试生成

**任务描述**: 仅对变更代码生成/更新测试  
**优先级**: P0  
**时间预估**: 2周  
**计划完成时间**: 第3月第4周  

**详细任务**:
1. 集成 Git 差异分析
2. 实现变更方法检测
3. 实现测试文件映射关系维护
4. 实现增量生成策略：
   - 新增方法 → 生成新测试
   - 修改方法 → 更新现有测试
   - 删除方法 → 标记废弃测试
5. 实现智能合并（保留手工修改）

**依赖关系**: 2.1  
**完成标准**:
- [ ] 能识别 Git diff 中的变更方法
- [ ] 仅生成变更部分的测试
- [ ] 不覆盖手工修改的测试代码

**测试用例**:
1. 新增一个方法，验证只生成该方法的测试
2. 修改现有方法，验证更新对应测试

---

### 2.3 Mock 智能推荐

**任务描述**: 基于依赖分析智能推荐 Mock 对象  
**优先级**: P1  
**时间预估**: 1周  
**计划完成时间**: 第4月第1周  

**详细任务**:
1. 分析类构造函数和字段注入
2. 识别需要 Mock 的外部依赖
3. 实现 Mock 代码自动生成
4. 支持 Mockito、PowerMock、Spock
5. 实现 Mock 行为建议（基于接口方法）

**依赖关系**: 1.2  
**完成标准**:
- [ ] 自动识别 @Autowired 字段
- [ ] 生成对应的 @Mock 注解
- [ ] 提供 Mock 行为代码片段

---

### 2.4 测试数据生成器

**任务描述**: 基于类型自动生成边界值测试数据  
**优先级**: P1  
**时间预估**: 1.5周  
**计划完成时间**: 第4月第3周  

**详细任务**:
1. 实现类型到测试数据的映射
2. 支持常见类型：String、int、Date、List、Map
3. 实现边界值生成：null、空值、最大值、最小值
4. 支持正则表达式生成匹配数据
5. 集成 JavaFaker 生成真实数据

**依赖关系**: 无  
**完成标准**:
- [ ] String 类型生成 null、""、超长字符串
- [ ] int 类型生成 -1、0、1、MAX_VALUE
- [ ] 支持自定义数据生成规则

---

## 三、Phase 3: 高级功能 (第4-5月)

### 3.1 变异测试集成

**任务描述**: 集成 PIT 变异测试，评估测试有效性  
**优先级**: P1  
**时间预估**: 2周  
**计划完成时间**: 第5月第2周  

**详细任务**:
1. 集成 PIT (Mutation Testing)
2. 实现变异算子配置
3. 实现变异结果解析
4. 生成变异测试报告
5. 根据变异结果建议补充测试

**依赖关系**: 2.1  
**完成标准**:
- [ ] 能运行变异测试并生成报告
- [ ] 识别存活变异并建议修复
- [ ] 变异覆盖率 > 70%

**测试用例**:
1. 运行变异测试，验证报告生成
2. 分析存活变异，验证建议准确

---

### 3.2 多 Agent 协作架构

**任务描述**: 重构为 Multi-Agent 架构  
**优先级**: P2  
**时间预估**: 3周  
**计划完成时间**: 第5月第5周  

**详细任务**:
1. 设计 Agent 角色：
   - Analyzer Agent：代码分析
   - Generator Agent：测试生成
   - Reviewer Agent：质量检查
   - Fixer Agent：自动修复
2. 实现 Agent 间通信机制
3. 实现任务分配和协调
4. 实现 Agent 记忆系统
5. 实现反思和学习机制

**依赖关系**: 全部前置任务  
**完成标准**:
- [ ] 各 Agent 可独立运行
- [ ] Agent 间可协作完成任务
- [ ] 支持 Agent 能力扩展

---

### 3.3 CI/CD 集成

**任务描述**: 提供 GitHub Actions / GitLab CI 插件  
**优先级**: P1  
**时间预估**: 1周  
**计划完成时间**: 第5月第4周  

**详细任务**:
1. 创建 GitHub Actions 模板
2. 创建 GitLab CI 模板
3. 实现 CI 模式（无交互）
4. 实现 PR 评论集成
5. 实现覆盖率门禁

**依赖关系**: 2.2  
**完成标准**:
- [ ] GitHub Actions 可正常使用
- [ ] PR 自动评论覆盖率变化
- [ ] 支持覆盖率门禁配置

---

### 3.4 契约测试生成

**任务描述**: 基于 OpenAPI/接口定义生成契约测试  
**优先级**: P2  
**时间预估**: 1.5周  
**计划完成时间**: 第6月第1周（可选）

**详细任务**:
1. 解析 OpenAPI/Swagger 文档
2. 生成 Spring Cloud Contract
3. 生成 Pact 契约测试
4. 实现契约验证

**依赖关系**: 1.3  
**完成标准**:
- [ ] 支持 OpenAPI 3.0 解析
- [ ] 生成可运行的契约测试

---

## 四、技术债务与优化

### 4.1 性能优化
- 并行生成测试（多线程）
- 缓存 AST 解析结果
- LLM 调用批处理

### 4.2 代码质量
- 单元测试覆盖率 > 80%
- 类型检查严格模式
- 代码复杂度检查

### 4.3 文档完善
- API 文档（Swagger）
- 架构设计文档
- 用户手册
- 开发贡献指南

---

## 五、里程碑与交付物

| 里程碑 | 时间 | 交付物 |
|--------|------|--------|
| M1 | 第1月末 | VS Code 插件、跨文件分析 |
| M2 | 第2月末 | JetBrains 插件、测试模板库 |
| M3 | 第3月末 | HTML 报告、增量测试 |
| M4 | 第4月末 | Mock 推荐、数据生成器 |
| M5 | 第5月末 | 变异测试、Multi-Agent、CI/CD |

---

## 六、风险与应对

| 风险 | 可能性 | 影响 | 应对措施 |
|------|--------|------|----------|
| LLM API 限制 | 中 | 高 | 实现本地模型回退、缓存机制 |
| IDE API 变更 | 低 | 中 | 关注官方文档、预留适配层 |
| 性能瓶颈 | 中 | 中 | 提前进行压力测试、优化算法 |
| 用户需求变更 | 中 | 低 | 敏捷开发、快速迭代 |

---

## 七、资源需求

**人力**:
- 核心开发：1-2人
- IDE 插件开发：1人（可并行）
- 测试与文档：0.5人

**工具/服务**:
- OpenAI API / DeepSeek API
- VS Code Extension 发布账号
- JetBrains Plugin 发布账号
- GitHub Actions Runner

---

## 八、验收标准

**功能验收**:
- 所有 P0 任务完成
- 测试生成成功率 > 90%
- 覆盖率提升 > 20%（对比手动编写）

**质量验收**:
- 代码覆盖率 > 80%
- 无严重 Bug
- 性能：单文件测试生成 < 30s

**文档验收**:
- 用户手册完整
- API 文档完整
- 示例项目可用

---

**计划制定日期**: 2026-02-16  
**计划版本**: v1.0  
**下次评审**: 每两周进行进度评审