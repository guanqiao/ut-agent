## UT生成过程监控优化方案

### 优化目标
1. 提供细粒度的进度追踪（文件级、百分比）
2. 实现实时事件反馈（LLM流式输出）
3. 统一监控数据视图
4. 增强错误追踪和性能分析

### 实施计划

#### 阶段一：事件总线基础设施
1. 创建 `EventBus` 统一事件发射/订阅机制
2. 定义标准化事件类型（进度、状态、错误、性能）
3. 支持同步/异步事件处理

#### 阶段二：细粒度进度追踪
1. 扩展 `AgentState` 添加进度字段
   - `total_files`: 总文件数
   - `processed_files`: 已处理文件数  
   - `current_file`: 当前处理文件
   - `stage_progress`: 各阶段进度百分比
2. 在各节点中发射进度事件
3. CLI/Web UI 展示百分比进度条

#### 阶段三：LLM流式输出监控
1. 实现 LLM 响应流式回调
2. 实时展示生成内容（可选显示）
3. 记录 token 使用量和生成速度

#### 阶段四：监控仪表板增强
1. CLI: Rich Live 面板展示多维度信息
2. Web UI: 添加监控页面（实时日志、进度、指标）
3. 支持导出监控报告

#### 阶段五：性能分析优化
1. 添加 `StageTimer` 各阶段耗时统计
2. 生成性能分析报告
3. 支持历史趋势对比

### 预期效果
- 用户可实时看到处理进度（如：`正在生成测试 [3/10] UserService.java`）
- LLM 生成过程可视化，减少等待焦虑
- 统一的监控视图，便于问题定位
- 详细的性能数据，支持优化决策