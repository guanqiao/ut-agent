# UT-Agent 增强功能开发计划

## 功能概述

本计划包含三个独立但相关的功能模块：
1. **JetBrains 插件** - IntelliJ IDEA 支持
2. **CI/CD 集成** - GitHub Actions/GitLab CI 模板
3. **变异测试集成** - PIT 测试有效性评估

---

## 一、JetBrains 插件开发

### 任务描述
开发 IntelliJ IDEA / PyCharm 插件，实现 IDE 内一键生成单元测试

### 优先级
P1

### 时间预估
2周

### 详细任务

#### 1.1 项目初始化 (Day 1-2)
- 创建 IntelliJ 插件项目结构 (`jetbrains-plugin/`)
- 配置 Gradle Kotlin DSL 构建脚本
- 配置 `plugin.xml` 元数据和扩展点
- 设置开发环境（IDEA SDK）

#### 1.2 核心功能实现 (Day 3-7)
- 实现 `AnAction`: "Generate Unit Test" 右键菜单
- 实现 `ToolWindowFactory`: 配置面板
- 集成 UT-Agent CLI 调用
- 实现进度指示器和后台任务
- 实现测试文件预览和 Diff 对比

#### 1.3 项目识别与配置 (Day 8-10)
- 实现 Gradle/Maven 项目自动识别
- 实现项目类型检测（Java/Kotlin/Spring Boot）
- 实现配置持久化（PropertiesComponent）
- 实现多模块项目支持

#### 1.4 测试与发布 (Day 11-14)
- 编写插件单元测试
- 编写集成测试
- 创建插件文档
- 发布到 JetBrains Marketplace

### 依赖关系
依赖现有 VS Code 插件架构和 UT-Agent CLI

### 完成标准
- [ ] 插件可在 JetBrains Marketplace 安装
- [ ] 支持 Java/Kotlin 项目
- [ ] 支持 Gradle/Maven 项目识别
- [ ] 右键菜单正常工作
- [ ] 配置面板功能完整

---

## 二、CI/CD 集成

### 任务描述
提供 GitHub Actions / GitLab CI 模板，实现流水线自动化测试生成

### 优先级
P1

### 时间预估
1周

### 详细任务

#### 2.1 GitHub Actions 模板 (Day 1-3)
- 创建 `.github/workflows/ut-agent.yml` 模板
- 实现 PR 触发测试生成
- 实现覆盖率报告上传
- 实现 PR 评论集成（覆盖率变化）
- 实现覆盖率门禁检查

#### 2.2 GitLab CI 模板 (Day 3-5)
- 创建 `.gitlab-ci.yml` 模板
- 实现 Merge Request 触发
- 实现 Artifacts 报告存储
- 实现 MR 讨论集成

#### 2.3 CI 模式增强 (Day 5-6)
- 实现 CLI 非交互模式 (`--ci` flag)
- 实现 JSON 输出格式 (`--output json`)
- 实现增量测试生成模式
- 实现失败时退出码

#### 2.4 文档与示例 (Day 7)
- 编写 CI/CD 集成文档
- 提供示例项目配置
- 编写故障排除指南

### 依赖关系
依赖 UT-Agent CLI 和增量测试功能

### 完成标准
- [ ] GitHub Actions 模板可直接使用
- [ ] GitLab CI 模板可直接使用
- [ ] PR 自动评论覆盖率变化
- [ ] 支持覆盖率门禁配置
- [ ] CI 模式无交互运行

---

## 三、变异测试集成

### 任务描述
集成 PIT (Pitest) 变异测试，评估测试有效性并建议补充测试

### 优先级
P1

### 时间预估
2周

### 详细任务

#### 3.1 PIT 集成 (Day 1-4)
- 添加 PIT Maven/Gradle 插件配置
- 实现变异算子配置
- 实现变异测试执行器
- 实现结果解析器

#### 3.2 结果解析与报告 (Day 5-8)
- 解析 PIT XML/HTML 报告
- 提取存活变异信息
- 映射变异到源代码位置
- 生成变异覆盖率报告

#### 3.3 智能建议系统 (Day 9-11)
- 分析存活变异模式
- 生成针对性测试建议
- 集成到现有工作流
- 实现迭代优化循环

#### 3.4 报告与可视化 (Day 12-14)
- 集成到 HTML 报告
- 添加变异覆盖率图表
- 实现变异详情展示
- 编写使用文档

### 依赖关系
依赖 HTML 报告功能和测试生成工作流

### 完成标准
- [ ] 能运行变异测试并生成报告
- [ ] 识别存活变异并建议修复
- [ ] 变异覆盖率 > 70%
- [ ] 集成到现有报告系统

---

## 四、目录结构规划

```
ut-agent/
├── jetbrains-plugin/           # JetBrains 插件
│   ├── src/
│   │   ├── main/
│   │   │   ├── kotlin/
│   │   │   │   └── com/utagent/
│   │   │   │       ├── actions/
│   │   │   │       │   └── GenerateTestAction.kt
│   │   │   │       ├── toolwindow/
│   │   │   │       │   └── UTAgentToolWindow.kt
│   │   │   │       ├── service/
│   │   │   │       │   └── UTAgentService.kt
│   │   │   │       └── config/
│   │   │   │           └── UTAgentConfig.kt
│   │   │   └── resources/
│   │   │       └── META-INF/
│   │   │           └── plugin.xml
│   │   └── test/
│   ├── build.gradle.kts
│   └── README.md
│
├── ci-templates/               # CI/CD 模板
│   ├── github/
│   │   └── ut-agent.yml
│   ├── gitlab/
│   │   └── .gitlab-ci.yml
│   └── README.md
│
├── src/ut_agent/
│   ├── tools/
│   │   └── mutation_analyzer.py  # 变异测试分析器
│   └── ci/                        # CI 模式支持
│       ├── __init__.py
│       ├── reporter.py
│       └── runner.py
│
└── docs/
    ├── jetbrains-plugin.md
    ├── ci-integration.md
    └── mutation-testing.md
```

---

## 五、里程碑

| 里程碑 | 时间 | 交付物 |
|--------|------|--------|
| M1 | 第1周末 | CI/CD 模板完成 |
| M2 | 第2周末 | JetBrains 插件发布 |
| M3 | 第4周末 | 变异测试集成完成 |

---

## 六、测试用例

### JetBrains 插件
1. 在 Java 文件右键生成测试，验证文件创建
2. 修改配置后重新生成，验证配置生效
3. 多模块项目测试生成

### CI/CD 集成
1. PR 触发测试生成，验证评论正确
2. 覆盖率门禁测试
3. 增量模式测试

### 变异测试
1. 运行变异测试，验证报告生成
2. 存活变异分析测试
3. 建议生成测试

---

**计划制定日期**: 2026-02-16  
**计划版本**: v1.0