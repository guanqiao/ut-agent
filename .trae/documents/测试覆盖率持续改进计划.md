## 测试覆盖率持续改进计划

### 一、修复失败测试 (10个)

#### 1. test_selection_change_detector.py (8个失败)
**问题原因**: Mock 路径不正确
- 测试使用 `@patch("ut_agent.selection.change_detector.git.Repo")` 
- 但实际代码使用 `import git` 然后 `git.Repo()`
- 正确的 patch 路径应该是 `ut_agent.selection.change_detector.git`

**修复方案**:
- 修改所有 `@patch("ut_agent.selection.change_detector.git.Repo")` 为 `@patch("ut_agent.selection.change_detector.git")`
- 更新 mock 对象的使用方式

#### 2. test_utils_llm.py (2个失败)
**问题原因**: ChatOpenAI 新增了 `http_client` 参数
- `create_model` 方法现在调用 `_create_http_client(config)` 创建 HTTP 客户端
- 测试的 mock 断言需要包含 `http_client` 参数

**修复方案**:
- 更新 `test_openai_create_model` 和 `test_deepseek_create_model` 测试
- Mock 断言需要包含 `http_client=None` 参数

### 二、新增测试模块

#### 1. tools/change_detector.py (24% → 60%+)
- 为 `ChangeDetector` 类编写完整测试
- 测试 Git 变更检测功能
- 测试方法变更解析

#### 2. memory 模块 (低覆盖率模块)
- `memory/manager.py` (31%)
- `memory/short_term.py` (25%)
- `memory/long_term.py` (28%)

### 三、验证步骤
1. 运行修复后的测试确保全部通过
2. 运行覆盖率分析验证提升
3. 确保总体覆盖率从 66% 提升到 70%+

### 四、预计时间
- 修复失败测试: 15分钟
- 新增测试: 30分钟
- 验证和调整: 10分钟